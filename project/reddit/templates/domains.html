{% extends "base.html" %}

{% block content %}
  <div class="row">
    <div class="col-lg-6">
      <div class="input-group">
        <input id="search-box" type="text" class="form-control" placeholder="Search for domain...">
      <span class="input-group-btn">
        <button class="btn btn-default" type="button">Go!</button>
      </span>
      </div><!-- /input-group -->
    </div><!-- /.col-lg-6 -->
  </div><!-- /.row -->
  <div class="row">
    <div id="container" style="min-width: 310px; height: 400px; margin: 0 auto"></div>
  </div>
{% endblock %}

{% block script %}
  <script>
    $(function () {
      $( "#search-box" ).autocomplete({
        source: "{% url 'domain_detail' %}",
        minLength: 2,
        select: function( event, ui ) {
          displayDomain(ui.item.value);
        }
      });
      function displayDomain(domain) {
        $.getJSON('', {'name': domain}, function (data) {
          data = _.chain(data)
            .uniq('month')
            .map(function (point) {
              var date = point.month.split('-');
              return [Date.UTC(date[0], date[1]), point.count];
            })
            .value();

          $('#container').highcharts({
            chart: {
              zoomType: 'x'
            },
            title: {
              text: 'Popularity of domain shared in Reddit comments'
            },
            subtitle: {
              text: document.ontouchstart === undefined ?
                'Click and drag in the plot area to zoom in' : 'Pinch the chart to zoom in'
            },
            xAxis: {
              type: 'datetime'
            },
            yAxis: {
              title: {
                text: 'Number of shares'
              }
            },
            legend: {
              enabled: false
            },
            plotOptions: {
              area: {
                fillColor: {
                  linearGradient: {
                    x1: 0,
                    y1: 0,
                    x2: 0,
                    y2: 1
                  },
                  stops: [
                    [0, Highcharts.getOptions().colors[0]],
                    [1, Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0).get('rgba')]
                  ]
                },
                marker: {
                  radius: 2
                },
                lineWidth: 1,
                states: {
                  hover: {
                    lineWidth: 1
                  }
                },
                threshold: null
              }
            },

            series: [{
              type: 'area',
              name: domain,
              data: data
            }]
          });
        });
      }
    });
  </script>
{% endblock %}